<!-- File: custom_sale_order_receipt_template.xml -->
<odoo>
    <template id="report_sale_order_document">
        <t t-call="web.basic_layout">
            <t t-foreach="docs" t-as="o">
                <div class="pos_receipt">
                    <!-- Enhanced CSS for single-page printing -->
                    <style>
                        @media print {
                            @page {
                                size: D05;
                                margin: 3mm;
                                overflow: hidden;
                            }
                            body {
                                margin: 0;
                                padding: 0;
                                width: 88mm;
                                -webkit-print-color-adjust: exact;
                            }
                            .pos_receipt {
                                width: 88mm;
                                margin: 0 auto;
                                font-size: 10px;
                                line-height: 1.2;
                                overflow: hidden;
                                page-break-after: always;
                                page-break-inside: avoid;
                            }
                            .company_info {
                                text-align: center;
                                margin-bottom: 5px;
                            }
                            .company_info img {
                                max-width: 60mm;
                                height: auto;
                            }
                            .order_info {
                                margin: 3px 0;
                            }
                            .order_lines {
                                width: 100%;
                                margin: 1px -2mm; /* Negative margin to extend table */
                                padding: 0;
                            }
                            .order_lines table {
                                width: calc(100% + 4mm); /* Compensate for negative margins */
                                border-collapse: collapse;
                                font-size: 9px;
                                margin: 0 auto; /* Center the table */
                            }
                            .order_lines th, .order_lines td {
                                padding: 1px 1px; /* Reduced padding */
                                border: none;
                                text-align: center; /* Center align all content */
                            }
                            .order_lines th {
                                font-weight: bold;
                                border-bottom: 0.5px solid #000;
                            }
                            .order_lines td:first-child,
                            .order_lines th:first-child {
                                padding-left: 0; /* Remove left padding for first column */
                            }
                            .order_lines td:last-child,
                            .order_lines th:last-child {
                                padding-right: 0; /* Remove right padding for last column */
                            }
                            .total_amount {
                                margin: 5px 0;
                                font-weight: bold;
                            }
                            .qr_code {
                                text-align: center;
                                margin: 5px 0;
                            }
                            .qr_code img {
                                max-width: 30mm;.order_lines {
                                    width: 100%;
                                    margin: 1px -2mm; /* Negative margin to extend table */
                                    padding: 0;
                                }
                                .order_lines table {
                                    width: calc(100% + 4mm); /* Compensate for negative margins */
                                    border-collapse: collapse;
                                    font-size: 9px;
                                    margin: 0 auto; /* Center the table */
                                }
                                .order_lines th, .order_lines td {
                                    padding: 1px 1px; /* Reduced padding */
                                    border: none;
                                    text-align: center; /* Center align all content */
                                }
                                .order_lines th {
                                    font-weight: bold;
                                    border-bottom: 0.5px solid #000;
                                }
                                .order_lines td:first-child,
                                .order_lines th:first-child {
                                    padding-left: 0; /* Remove left padding for first column */
                                }
                                .order_lines td:last-child,
                                .order_lines th:last-child {
                                    padding-right: 0; /* Remove right padding for last column */
                                }
                                height: auto;
                            }
                            .receipt_footer {
                                text-align: center;
                                font-size: 8px;
                                margin-top: 5px;
                            }
                            /* Auto-scaling text for long content */
                            .scale-text {
                                white-space: nowrap;
                                overflow: hidden;
                                text-overflow: ellipsis;
                            }
                            /* Compact table styles */
                            .compact-table {
                                font-size: 8px;
                                line-height: 1.1;
                            }
                            .compact-table td, .compact-table th {
                                padding: 1px 2px;
                            }
                        }
                    </style>

                    <!-- Company Information -->
                    <div class="company_info">
                        <t t-if="o.company_id.logo">
                            <img t-att-src="'data:image/png;base64,%s' % o.company_id.logo"/>
                        </t>
                        <div t-field="o.company_id.name" class="scale-text"/>
                    </div>

                    <!-- Order Information -->
                    <div class="order_info">
                        <div class="scale-text">Order: <span t-field="o.name"/></div>
                        <div class="scale-text">Date: <span t-field="o.date_order"/></div>
                        <div class="scale-text">Customer: <span t-field="o.partner_id.name"/></div>
                    </div>

                    <!-- Order Lines -->
                    <div class="order_lines">
                        <table class="compact-table">
                            <thead>
                                <tr>                                    
                                    <th style="width: 15%">Qty</th>
                                    <th style="width: 45%">Item</th>
                                    <th style="width: 20%">Price</th>
                                    <th style="width: 20%">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach="o.order_line" t-as="line">                                    
                                    <td style="text-align: center"><span t-field="line.product_uom_qty"/></td>
                                    <td class="scale-text" style="text-align: left"><span t-field="line.product_id.name"/></td>
                                    <td style="text-align: right"><span t-field="line.price_unit"/></td>
                                    <td style="text-align: right"><span t-field="line.price_subtotal"/></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Total Amount -->
                    <div class="total_amount">
                        <div>Subtotal: <span t-field="o.amount_untaxed"/></div>
                        <div>Tax: <span t-field="o.amount_tax"/></div>
                        <div>Total: <span t-field="o.amount_total"/></div>
                    </div>

                    <!-- QR Code -->
                    <div class="qr_code">
                        <t t-if="o.qr_code">
                            <img t-att-src="'data:image/png;base64,%s' % o.qr_code.decode('utf-8')"/>
                        </t>
                    </div>

                    <!-- Footer -->
                    <div class="receipt_footer">
                        <div>Thank you for your business!</div>
                        <div t-field="o.company_id.phone"/>
                        <div t-field="o.company_id.email"/>
                    </div>
                </div>
            </t>
        </t>
    </template>
</odoo>